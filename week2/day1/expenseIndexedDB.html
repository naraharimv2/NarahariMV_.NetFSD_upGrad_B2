<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker - IndexedDB</title>
</head>
<body>

    <h2>ðŸ’° Mini Expense Tracker (IndexedDB)</h2>

    <label>Expense Title:</label><br>
    <input type="text" id="title"><br><br>

    <label>Amount:</label><br>
    <input type="number" id="amount"><br><br>

    <label>Date:</label><br>
    <input type="date" id="date"><br><br>

    <button onclick="addExpense()">Add Expense</button>
    <button onclick="viewExpenses()">View Expenses</button>

    <h3>Delete Expense</h3>
    <label>Enter ID to Delete:</label>
    <input type="number" id="deleteId">
    <button onclick="deleteExpense()">Delete</button>

    <h3>Expense List:</h3>
    <ul id="expenseList"></ul>

<script>

let db;

// âœ… Open Database
let request = indexedDB.open("ExpenseDB", 1);

request.onupgradeneeded = function(event) {
    db = event.target.result;
    db.createObjectStore("expenses", { keyPath: "id", autoIncrement: true });
};

request.onsuccess = function(event) {
    db = event.target.result;
    console.log("Database opened successfully");
    viewExpenses(); // auto show data on load
};

request.onerror = function() {
    alert("Database failed to open");
};

// âœ… Add Expense
function addExpense() {

    let title = document.getElementById("title").value;
    let amount = document.getElementById("amount").value;
    let date = document.getElementById("date").value;

    let transaction = db.transaction(["expenses"], "readwrite");
    let store = transaction.objectStore("expenses");

    let expense = {
        title: title,
        amount: amount,
        date: date
    };

    store.add(expense);

    transaction.oncomplete = function() {
        alert("Expense Added Successfully");
        viewExpenses();
    };

    transaction.onerror = function() {
        alert("Transaction Failed");
    };
}

// âœ… View Expenses
function viewExpenses() {

    let transaction = db.transaction(["expenses"], "readonly");
    let store = transaction.objectStore("expenses");

    let request = store.getAll();

    request.onsuccess = function() {

        let list = document.getElementById("expenseList");
        list.innerHTML = "";

        request.result.forEach(function(exp) {

            let li = document.createElement("li");

            li.innerHTML =
                "ID: " + exp.id +
                " | Title: " + exp.title +
                " | Amount: â‚¹" + exp.amount +
                " | Date: " + exp.date;

            list.appendChild(li);
        });
    };
}

// âœ… Delete Expense
function deleteExpense() {

    let id = Number(document.getElementById("deleteId").value);

    let transaction = db.transaction(["expenses"], "readwrite");
    let store = transaction.objectStore("expenses");

    store.delete(id);

    transaction.oncomplete = function() {
        alert("Expense Deleted Successfully");
        viewExpenses();
    };

    transaction.onerror = function() {
        alert("Delete Failed");
    };
}

</script>

</body>
</html>